本题考察了贪心的相关知识。

### 40pts

显然最终经过了 $2k+dis(1,n)$ 条边，因此 $n≡dis(1,n)( \bmod2)$ 就合法，否则不合法。

先考虑最小值，即只经过 $path(1,n)$ 的方案。

那么对于路径上第 $i$ 个点 $c_i$，设他在路径外的子树大小为 $siz(c_i)$。

我们发现很多操作都要在折返中抵消，那么我们只要钦定链上哪些操作最终有用，剩下的操作形成若干跨子树的匹配，那么我们一定能构造一个合法的 $p$。

根据经典结论，那么我们要求剩下的操作中不存在绝对众数。

找到最大的 $siz(c_i)$，那么我们至多在他的子树里钦定 $i$ 个没被抵消。

因此这种情况的充要条件就是 $siz(c_i)−i≤2n−dis(1,n)$，显然这样的 $i$ 至多一个，因此我们能构造出一个合法的匹配。

否则找到不合法的这棵子树，枚举一个连通块 $S$，记每个连通块内节点 $u$ 在连通块外的子树大小为 $siz(u)$。

那么我们依然要求 $siz(u)−i≤2n−dis(1,n)$，证明大致同上。

那么我们要在这个基础上保留尽可能少的节点是的所有 $siz(u)$ 不超过 $k=2n−dis(1,n)+i$。

问题就变成：给一棵 $n$ 顶点的树，可以断掉若干的边，要求断掉的边连通且连通块包含 $1$ 节点。要求剩下每个连通块大小不超过 $k$，求最小分割数，可以进行树形DP求解这个值，时间复杂度为 $O(n^2)$。

### +10pts

考虑整张图为菊花图，所以除了 $1$ 号点以外的地位相同，可以把除 $n$ 号点的以外的点两两抵消，按照 $n$ 的奇偶性进行分类讨论即可。

###  100pts

注意到 $siz(c_i)≤n−dis(1,n)≤2k$，因此不合法的所有点构成一条链，对于每个点贪心地割掉若干个最大的子树即可。

时间复杂度 $O(n \log n)$，如果利用桶排序，时间复杂度为 $O(n)$。
