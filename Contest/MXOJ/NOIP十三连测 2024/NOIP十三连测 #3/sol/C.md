本题考察了树的直径，二分图的相关知识。

### 10pts

爆搜所有 $2^n$ 种情况，求最远点对距离即可。

### 40pts

考虑把 $O(n^2)$ 对点对依次取出排好序，考虑如果答案 $<x$，意味着所有点对距离 $\geq x$ 的点对颜色必须两两不同，把这些约束取出，相当于一个二分图染色的问题，于是我们可以很方便的算出 $<x$ 的答案，利用差分即可算出 $=x$ 的答案。

### 100pts

先求出一条直径，若直径的两个端点颜色相同，则最长距离一定为直径。否则，令两个端点分别为 $x,y$，并钦定 $x,y$ 不同色。枚举答案 $d$，所有到 $x$ 距离 $>d$ 的点颜色必须与 $y$ 一样，所有到 $y$ 距离 $>d$ 的点颜色必须和 $x$ 一样。由于 $x,y$ 是直径的两个端点，可以发现，若一个点 $z$ 到 $x,y$ 的距离都不超过 $d$，则其到任何一个点的距离不超过 $d$，所以 $z$ 的颜色并不会对答案产生影响。

所以，定义 $cnt_i$ 表示到直径两端的距离不超过 $i$ 的点数。定义 $f_d$ 表示答案不超过 $d$ 的树的形态数，$g_d$ 表示答案为 $d$ 的树的形态数，$dis_{1/2}$ 表示从直径的两端点出发到其他点的距离。定义 $L=\max(\min(dis_{1i}, dis_{2i}))$。此处 $L$ 的意义为，在所有形态的树中，最小的答案（同色点对最大距离）。对于每个点取到直径两端点近的那个颜色即可。

最终的总权值为 $\sum_{i=L}^{S} g_i \times i$。

容易得到 $f_d = 2^{cnt_d}$。但是我们想要答案等于 $d$ 的树的形态数 $g_i$。很明显，只需要容斥减去 $f_{d-1}$ 即可，也就是 $g_d = f_d - f_{d-1}$。

注意 $x,y$ 共有 2 种颜色分配方案。
